(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[551],{2741:function(e,t,s){Promise.resolve().then(s.bind(s,1180))},1180:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return j}});var l=s(7437),a=s(3429),i=s(9175),r=s(8407),n=s(9842),d=s(2265),o=s(6463),c=s(9212),u=s.n(c),v=function(e){let{index:t,profile_img:s,name:a,selected:i,onClick:r,lastMessage:n,lastMessageTime:d,id:c,setSelectedCat:v,cat:h}=e,m=(0,o.useRouter)();return(0,l.jsx)("div",{onClick:()=>{v(h),m.push("/chat/".concat(c))},className:"flex bg-secondary flex-col sm:flex-row py-4 rounded-md px-4 justify-between items-center mx-2 cursor-pointer transition-all duration-300 ease-in-out ".concat(i?"bg-success text-white":"border-transparent text-white"),children:(0,l.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,l.jsx)("div",{className:"relative",onClick:e=>{e.stopPropagation(),r(t)},children:(0,l.jsx)("img",{src:s,className:"object-cover h-12 w-12 sm:h-14 sm:w-14 md:h-16 md:w-16 rounded-full ",alt:a})}),(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsxs)("p",{className:"text-base text-sm flex items-center text-white",children:[a,(0,l.jsx)("span",{className:"ml-2 w-2 h-2 rounded-full bg-green-500"}),(0,l.jsx)("span",{className:"text-[10px] ml-auto",children:u()(d).format("hh:mm A")})]}),n&&(0,l.jsx)("span",{className:"text-gray-300 text-sm overflow-ellipsis overflow-hidden whitespace-normal",children:null==n?void 0:n.substring(0,80)})]})]})},c)},h=()=>{let{user:e}=(0,a.a)(),[t,s]=(0,d.useState)(!1),[c,u]=(0,d.useState)(""),[h,m]=(0,d.useState)([]),{selectedCat:x,setSelectedCat:p}=(0,i.t)(),f=(0,o.useRouter)(),[g,w]=(0,d.useState)(!0);return(0,d.useEffect)(()=>{if(e){let t=(0,n.IO)((0,n.hJ)(r.db,"chats"),(0,n.ar)("userIDs","array-contains",null==e?void 0:e.uid),(0,n.Xo)("createdAt","desc")),s=(0,n.cf)(t,e=>{m(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>s()}},[e]),(0,d.useEffect)(()=>{let e=()=>{w(window.innerWidth>=768)};return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),(0,l.jsx)("div",{className:"rounded-xl ".concat(g?"h-[calc(107vh-60px)]":"h-20"," w-auto bg-secondary text-black border col-span-1 shadow-md"),children:g?(0,l.jsx)("div",{className:"h-full overflow-y-auto",children:h.length>0?h.map((e,t)=>{var s,a,i,r,n,d,o,c,u,h,m;return(0,l.jsx)(v,{id:null==e?void 0:e.id,index:t,name:null==e?void 0:null===(i=e.participants)||void 0===i?void 0:null===(a=i[1])||void 0===a?void 0:null===(s=a.secondUser)||void 0===s?void 0:s.name,lastMessage:null==e?void 0:e.lastMessage,lastMessageTime:null==e?void 0:e.lastMessageAt,profile_img:null==e?void 0:null===(d=e.participants)||void 0===d?void 0:null===(n=d[1])||void 0===n?void 0:null===(r=n.secondUser)||void 0===r?void 0:r.imageSrc,selected:(null==x?void 0:x.id)==(null==e?void 0:null===(u=e.participants)||void 0===u?void 0:null===(c=u[1])||void 0===c?void 0:null===(o=c.secondUser)||void 0===o?void 0:o.id),cat:null==e?void 0:null===(m=e.participants)||void 0===m?void 0:null===(h=m[1])||void 0===h?void 0:h.secondUser,setSelectedCat:p},null==e?void 0:e.id)}):(0,l.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,l.jsx)("p",{className:"text-center text-white",children:"No chats available"})})}):h.length>0&&(0,l.jsx)("div",{className:"flex space-x-2 h-18 overflow-x-auto items-center justify-center",children:h.map(e=>{var t,s,a,i,r,n,d,o,c,u,v,h;return(0,l.jsxs)("div",{className:"flex flex-col items-center mt-2 cursor-pointer",onClick:()=>{var t,s;p(null==e?void 0:null===(s=e.participants)||void 0===s?void 0:null===(t=s[1])||void 0===t?void 0:t.secondUser),f.push("/chat/".concat(null==e?void 0:e.id))},children:[(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("img",{src:null==e?void 0:null===(a=e.participants)||void 0===a?void 0:null===(s=a[1])||void 0===s?void 0:null===(t=s.secondUser)||void 0===t?void 0:t.imageSrc,alt:null==e?void 0:null===(n=e.participants)||void 0===n?void 0:null===(r=n[1])||void 0===r?void 0:null===(i=r.secondUser)||void 0===i?void 0:i.name,className:"w-12 h-12 rounded-full ".concat((null==x?void 0:x.id)==(null==e?void 0:null===(c=e.participants)||void 0===c?void 0:null===(o=c[1])||void 0===o?void 0:null===(d=o.secondUser)||void 0===d?void 0:d.id)?"border-2 border-round border-success text-white":"border-transparent text-white")}),(0,l.jsx)("span",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full  "})," "]}),(0,l.jsx)("span",{className:"text-xs text-white text-center",children:null==e?void 0:null===(h=e.participants)||void 0===h?void 0:null===(v=h[1])||void 0===v?void 0:null===(u=v.secondUser)||void 0===u?void 0:u.name})]},null==e?void 0:e.id)})})})};let m=async(e,t)=>{let s=(null==e?void 0:e.uid)+(null==t?void 0:t.id),l=(0,n.JU)(r.db,"chats",s);try{(await (0,n.QT)(l)).exists()?await (0,n.r7)(l,{updatedAt:u()().valueOf()}):await (0,n.pl)(l,{uid:s,createdAt:u()().valueOf(),participants:[{user:e},{secondUser:t}],userIDs:[null==e?void 0:e.uid,null==t?void 0:t.id],thread:[]})}catch(e){throw console.error("Error creating/updating chat:",e),e}},x=(e,t)=>{try{let s=(0,n.JU)(r.db,"chats",e);return(0,n.cf)(s,e=>{if(e.exists()){let s=e.data();s.thread&&s.thread.length>0&&s.thread.sort((e,t)=>t.timestamp-e.timestamp),t(s)}else t(null)})}catch(e){throw console.error("Error fetching chat record:",e),e}},p=async(e,t)=>{try{let s=(0,n.JU)(r.db,"chats",e);console.log(e,t,"chatID, message"),await (0,n.r7)(s,{thread:(0,n.vr)(t),lastMessage:t.message,lastMessageAt:u()().valueOf()})}catch(e){throw console.error("Error sending message:",e),e}};var f=function(e){let{message:t,cat:s}=e;return(0,l.jsxs)("div",{className:"p-4 flex gap-2 items-end",children:[(0,l.jsx)("img",{src:s,className:"object-cover h-12 w-12 rounded-full shadow-md",alt:"cat"}),(0,l.jsx)("div",{className:"w-[70%] flex flex-col items-end gap-1",children:(0,l.jsx)("div",{className:"bg-white text-gray-900 rounded-lg p-2 text-sm  border-opacity-10 shadow-lg",children:t})})]})},g=function(e){let{message:t}=e;return(0,l.jsx)("div",{className:"p-4 flex items-end justify-start flex-row-reverse gap-2",children:(0,l.jsx)("div",{className:"w-[70%]",children:(0,l.jsx)("div",{className:"bg-success text-gray-100 rounded-lg p-3 text-sm border-opacity-10 shadow-lg",children:t})})})},w=e=>{let{selectedCatId:t}=e,[s,r]=(0,d.useState)([]),[n,o]=(0,d.useState)(""),{user:c}=(0,a.a)(),[u,v]=(0,d.useState)(null),[h,w]=(0,d.useState)(t),[j,b]=(0,d.useState)(!1),[N,y]=(0,d.useState)(!1),{selectedCat:S,setSelectedCat:E}=(0,i.t)();(0,d.useEffect)(()=>{if((null==c?void 0:c.uid)&&t){let e=t;t.includes(c.uid)&&(e=t.replace(c.uid,"")),w(e);let s=c.uid,l=e;(async()=>await x(s+l,e=>{e?(r(e.thread||[]),b(!0)):b(!1)}))().catch(e=>console.error("Error setting up chat listener:",e)),v(c)}},[t,c]);let C=async()=>{if(""!==n.trim()){let e={message:n,sentBy:null==c?void 0:c.uid};try{j||(await m(c,S),b(!0)),await p((null==c?void 0:c.uid)+h,e),o(""),y(!0);let t=(null==c?void 0:c.uid)+h,s=await fetch("".concat("https://us-central1-catchatapp-6f11c.cloudfunctions.net/catchatapi/api","/chat/").concat(t),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(S)});s.ok||console.error("Error generating message:",s.statusText),y(!1)}catch(e){console.error("Error sending message:",e),y(!1)}}};return(0,l.jsxs)("div",{className:"col-span-2 h-screen flex flex-col",children:[S&&(0,l.jsxs)("header",{className:"flex items-center gap-4 p-4 bg-gradient-to-r from-indigo-500 to-purple-500 shadow-lg text-white rounded-md",children:[(0,l.jsx)("img",{src:null==S?void 0:S.imageSrc,alt:null==S?void 0:S.name,className:"w-14 h-14 rounded-full border-2 border-white"}),(0,l.jsx)("h1",{className:"text-xl font-bold",children:null==S?void 0:S.name})]}),(0,l.jsxs)("div",{className:"flex-grow overflow-y-auto p-4",children:[s&&s.length>0?(0,l.jsx)("div",{children:s.map(e=>(0,l.jsx)("div",{children:(null==e?void 0:e.sentBy)===(null==c?void 0:c.uid)?(0,l.jsx)(g,{message:null==e?void 0:e.message}):(0,l.jsx)(f,{message:null==e?void 0:e.message,cat:null==S?void 0:S.imageSrc})},null==e?void 0:e.id))}):(0,l.jsx)("div",{className:"h-full flex items-center justify-center text-gray-500",children:"No chat available. Start a conversation!"}),N&&(0,l.jsxs)("div",{className:"text-gray-500 text-sm italic px-4 pt-2 animate-float",children:[null==S?void 0:S.name," is typing..."]})]}),(0,l.jsx)("footer",{className:"p-4 border-t border-gray-300 ",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"relative w-full",children:(0,l.jsx)("input",{type:"text",className:"bg-white w-full rounded-xl text-black p-4 outline-none",placeholder:"Type Here",value:n,onChange:e=>o(e.target.value),onKeyDown:e=>{"Enter"===e.key&&C()}})}),(0,l.jsx)("button",{className:"w-12 h-12 flex justify-center items-center bg-indigo-600 rounded-full",onClick:C,children:(0,l.jsx)("img",{src:"/send.svg",alt:"send",className:"w-6 h-6"})})]})})]})};function j(e){let{params:t}=e;return(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4",children:[(0,l.jsx)("div",{className:"md:block",children:(0,l.jsx)(h,{})}),(0,l.jsx)(w,{selectedCatId:t.characterId})]})}},3429:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return o},a:function(){return c}});var l=s(7437),a=s(2265),i=s(5186),r=s(8407),n=s(6463);let d=(0,a.createContext)(void 0);function o(e){let{children:t}=e,[s,o]=(0,a.useState)(null),[c,u]=(0,a.useState)(!0),v=(0,n.useRouter)();(0,a.useEffect)(()=>{let e=(0,i.Aj)(r.I,e=>{if(e){let{uid:t,email:s,displayName:l}=e;o({uid:t,email:s,displayName:l||""}),v.push("/")}else o(null);u(!1)});return()=>e()},[v]);let h=async()=>{await (0,i.w7)(r.I),v.push("/")};return(0,l.jsx)(d.Provider,{value:{user:s,logout:h,loading:c},children:!c&&t})}let c=()=>{let e=(0,a.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9175:function(e,t,s){"use strict";s.d(t,{CatProvider:function(){return r},t:function(){return n}});var l=s(7437),a=s(2265);let i=(0,a.createContext)(void 0),r=e=>{let{children:t}=e,[s,r]=(0,a.useState)(null);return(0,l.jsx)(i.Provider,{value:{selectedCat:s,setSelectedCat:r},children:t})},n=()=>{let e=(0,a.useContext)(i);if(void 0===e)throw Error("useCat must be used within a CatProvider");return e}},8407:function(e,t,s){"use strict";s.d(t,{I:function(){return n},db:function(){return d}});var l=s(5236),a=s(5186),i=s(9842);let r=(0,l.ZF)({apiKey:"AIzaSyDuv36J-p2SqwS-SkIvZ2RbYUDAeFpmW3Y",authDomain:"catchatapp-6f11c.firebaseapp.com",projectId:"catchatapp-6f11c",storageBucket:"catchatapp-6f11c.appspot.com",messagingSenderId:"939250469034",appId:"1:939250469034:web:64f3aed214182395c768d3"}),n=(0,a.v0)(r),d=(0,i.ad)(r)}},function(e){e.O(0,[358,691,990,609,971,23,744],function(){return e(e.s=2741)}),_N_E=e.O()}]);